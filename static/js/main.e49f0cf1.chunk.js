(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,a){},101:function(e,t,a){},102:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),o=a(44),i=a.n(o),l=(a(53),a(2)),r=a(3),c=a(5),h=a(4),u=a(1),d=a(6),m=a(45),g=a.n(m),v=a(46),f=a.n(v),p=a(20),b=a.n(p),w=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(h.a)(t).call(this,e))).fadeOut=a.fadeOut.bind(Object(u.a)(a)),a.state={hidden:!0,message:"",interval:setTimeout(a.fadeOut,0),time:a.props.time},a}return Object(d.a)(t,e),Object(r.a)(t,[{key:"componentWillUnmount",value:function(){clearTimeout(this.state.interval),this.setState({interval:null})}},{key:"componentDidUpdate",value:function(){this.props.time!==this.state.time&&this.props.message&&this.setState({hidden:!1,message:this.props.message,interval:setTimeout(this.fadeOut,this.props.toastDuration),time:this.props.time})}},{key:"fadeOut",value:function(){this.setState({hidden:!0})}},{key:"render",value:function(){return s.a.createElement("div",{className:this.state.hidden?"toast hidden":"toast visible",tabIndex:"100"},this.state.message)}}]),t}(s.a.Component),y=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(h.a)(t).call(this,e))).state={message:"",passwordInput:"",nameInput:"",newAccount:!1},a.handleProceedButton=a.handleProceedButton.bind(Object(u.a)(a)),a.handleNameChange=a.handleNameChange.bind(Object(u.a)(a)),a.handlePasswordChange=a.handlePasswordChange.bind(Object(u.a)(a)),a.handleNewAccountChange=a.handleNewAccountChange.bind(Object(u.a)(a)),a.handleEnterkey=a.handleEnterkey.bind(Object(u.a)(a)),a}return Object(d.a)(t,e),Object(r.a)(t,[{key:"handleEnterkey",value:function(e){13===e.keyCode&&this.handleProceedButton()}},{key:"handleProceedButton",value:function(){this.props.handleProceedButton(this.state.nameInput,this.state.passwordInput,this.state.newAccount)}},{key:"handleNameChange",value:function(e){this.setState({nameInput:e.target.value})}},{key:"handlePasswordChange",value:function(e){this.setState({passwordInput:e.target.value})}},{key:"handleNewAccountChange",value:function(e){this.setState({newAccount:e.target.checked})}},{key:"render",value:function(){return s.a.createElement("div",{className:"chat-app container login"},s.a.createElement("form",{onSubmit:function(e){e.preventDefault()}},s.a.createElement("h1",{className:"login-text"},"Welcome to Chat"),s.a.createElement("p",{className:"login-subtext"},"Login or Create an Account to start chatting.",s.a.createElement("br",null)," Enter your username and password or create new ones, and an account will be created for you."),s.a.createElement("input",{className:"login-field theme-input",placeholder:"Full Name",maxLength:"64",value:this.state.nameInput,onChange:this.handleNameChange}),s.a.createElement("input",{className:"login-field theme-input",type:"password",onKeyUp:this.handleEnterkey,placeholder:"Password",maxLength:"128",value:this.state.passwordInput,onChange:this.handlePasswordChange}),s.a.createElement("br",null),s.a.createElement("button",{className:"theme-btn login-field",onClick:this.handleProceedButton},"Proceed"),s.a.createElement("br",null),s.a.createElement("input",{type:"checkbox",className:"checkbox",id:"new-account",checked:this.state.newAccount,onChange:this.handleNewAccountChange}),s.a.createElement("label",{htmlFor:"new-account"},"\xa0Create a new account"),s.a.createElement("br",null),s.a.createElement("p",{className:"message"},this.props.message),s.a.createElement("small",null,"v3.0 ",s.a.createElement("br",null),"\xa9 2019 Diyanshu Agrawal. All rights reserved.")))}}]),t}(s.a.Component),S=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(h.a)(t).call(this,e))).scrollToBottom=function(){a.messagesEnd.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})},a.state={newMessage:"",chat:e.chat,name:e.name,scrollTop:null,refreshInterval:null},a.handleMessageBoxChange=a.handleMessageBoxChange.bind(Object(u.a)(a)),a.handleMessageBoxKeyPress=a.handleMessageBoxKeyPress.bind(Object(u.a)(a)),a.handleSmiley=a.handleSmiley.bind(Object(u.a)(a)),a}return Object(d.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentWillUnmount",value:function(){clearInterval(this.state.refreshInterval)}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"handleMessageBoxChange",value:function(e){this.setState({newMessage:e.target.value})}},{key:"handleMessageBoxKeyPress",value:function(e){if(13===e.keyCode){var t=this.state.newMessage,a=this.props.chatId;this.props.submitMessage(this.state.name,t,a),this.setState({newMessage:""}),this.textBox.blur()}}},{key:"handleSmiley",value:function(){var e=this.state.newMessage;e+=" \ud83d\ude42 ",this.setState({newMessage:e}),this.textBox.focus()}},{key:"render",value:function(){var e=this,t=[];if(this.state.chat){var a=!0,n=!1,o=void 0;try{for(var i,l=this.state.chat.messages[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var r=i.value,c="chat-bubble "+(r.from===this.state.name?"received":"sent");t.push(s.a.createElement("div",{className:c,key:r._id},s.a.createElement("div",{className:"chat-bubble-info"},r.from),s.a.createElement("div",{className:"chat-bubble-message"},r.message)))}}catch(h){n=!0,o=h}finally{try{a||null==l.return||l.return()}finally{if(n)throw o}}return s.a.createElement("div",{className:"chatbox "},s.a.createElement("div",{className:"bubble-container"},t,s.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}})),s.a.createElement("div",{className:"chat-text-box-container"},s.a.createElement("input",{className:"chat-text-box",placeholder:"Enter your message here",value:this.state.newMessage,onChange:this.handleMessageBoxChange,onKeyUp:this.handleMessageBoxKeyPress,maxLength:256,ref:function(t){e.textBox=t}}),s.a.createElement("button",{className:"smiley-button option-button",title:"Send smiling face",onClick:this.handleSmiley},"\ud83d\ude42"),s.a.createElement("div",{className:"clearfix"})))}return s.a.createElement("div",{className:"chatbox "},s.a.createElement("div",{className:"bubble-container"},s.a.createElement("p",{className:"text-center white-text"},"Choose a conversation to show messages."),s.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.chat&&e.name&&(e.chat===t.chat&&e.name===t.name||(t.name=e.name,t.chat=e.chat)),t}}]),t}(s.a.Component);var C=function(e){return e.status.focus?s.a.createElement("div",null,s.a.createElement("div",{className:"search-result visible"},s.a.createElement("div",{className:"search-results-list"},e.status.resultElement))):s.a.createElement("div",null)},E=a(35),k=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(h.a)(t).call(this,e))).handleInputChange=a.handleInputChange.bind(Object(u.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(u.a)(a)),a.handleFocus=a.handleFocus.bind(Object(u.a)(a)),a.handleBlur=a.handleBlur.bind(Object(u.a)(a)),a.state={query:"",visible:!1,result:"",id:"search-input",resultElement:s.a.createElement("span",null,"Press enter to search, and only an exact match will appear for privacy.")},a}return Object(d.a)(t,e),Object(r.a)(t,[{key:"handleBlur",value:function(){this.setState({focus:!1,query:""})}},{key:"handleFocus",value:function(){this.setState({focus:!0})}},{key:"handleInputChange",value:function(e){this.setState({query:e.target.value})}},{key:"handleSubmit",value:function(e){var t=this;if(13===e.keyCode){this.props.handleToast("Searching",2e3);var a=this.state.query;E.post("".concat(this.props.globalSettings.serverRoot,"my-chats/search"),{query:a,people:this.props.people,withCredentials:!0},{withCredentials:!0}).then(function(e){t.props.handleSearchResult(e)}).catch(function(e){console.error("Searching",e)}),this.setState({query:""})}}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("input",{className:"theme-btn chat-search",placeholder:"Search for people",onChange:this.handleInputChange,onKeyUp:this.handleSubmit,value:this.state.query,onFocus:this.handleFocus,onBlur:this.handleBlur}),s.a.createElement(C,{status:this.state,maxLength:64}))}}]),t}(s.a.Component),O=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(h.a)(t).call(this,e))).activate=a.activate.bind(Object(u.a)(a)),a}return Object(d.a)(t,e),Object(r.a)(t,[{key:"activate",value:function(){this.props.onActivate(this.props.name)}},{key:"render",value:function(){var e="#"+this.props.name;return s.a.createElement("li",{c:!0,className:this.props.active?"active":"",onClick:this.activate,href:e,id:this.props.name},this.props.name)}}]),t}(s.a.Component),j=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(h.a)(t).call(this,e))).state={online:a.props.online?"online":"offline",name:a.props.name},a}return Object(d.a)(t,e),Object(r.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.online===e.online&&this.props.name===e.name||this.setState({online:this.props.online?"online":"offline",name:this.props.name})}},{key:"render",value:function(){var e="offline-alert "+this.state.online;return this.state.name?s.a.createElement("div",{className:e},this.props.name," is ",this.state.online):null}}]),t}(s.a.Component),N=(a(99),a(100),a(101),a(47)),x=a.n(N),I=a(35),M=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(h.a)(t).call(this,e))).state={menuVisible:"ivisible",chatInterval:null,notDownloaded:!0,toast:null,toastTime:Date.now(),toastDuration:5e3,active:null,activeChatIndex:-1,online:!1,globalSettings:g.a.globalSettings,chats:[]},a.activate=a.activate.bind(Object(u.a)(a)),a.handleProceedButton=a.handleProceedButton.bind(Object(u.a)(a)),a.fecthNewMessagesForParticularChat=a.fecthNewMessagesForParticularChat.bind(Object(u.a)(a)),a.submitMessage=a.submitMessage.bind(Object(u.a)(a)),a.handleNewChat=a.handleNewChat.bind(Object(u.a)(a)),a.refreshChatLists=a.refreshChatLists.bind(Object(u.a)(a)),a.setupSockets=a.setupSockets.bind(Object(u.a)(a)),a.createInitialChatRefreshInterval=a.createInitialChatRefreshInterval.bind(Object(u.a)(a)),a.handleToast=a.handleToast.bind(Object(u.a)(a)),a.handleMenuToggle=a.handleMenuToggle.bind(Object(u.a)(a)),a}return Object(d.a)(t,e),Object(r.a)(t,[{key:"createInitialChatRefreshInterval",value:function(){console.log("Initial Chat Lists Interval Set for 6000 seconds"),this.setState({chatInterval:setInterval(this.refreshChatLists,6e3)})}},{key:"refreshChatLists",value:function(){var e=this;if(this.state.globalSettings.name){var t=[];if(this.state.chats){var a=!0,n=!1,s=void 0;try{for(var o,i=this.state.chats[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var l=o.value;t.push(l.name)}}catch(r){n=!0,s=r}finally{try{a||null==i.return||i.return()}finally{if(n)throw s}}}I.post("".concat(this.state.globalSettings.serverRoot,"my-chats/refresh-chats"),{people:t,withCredentials:!0},{withCredentials:!0}).then(function(t){var a=t.data;if(a.error)console.error("Refresh chats error ->",a.error),e.setState({toast:"Error while refreshing chat lists",toastTime:Date.now(),toastDuration:5e3});else if(!a.empty&&a){var n=e.state.chats;n=n.concat(a),e.setState({chats:n,toast:"New conversation loaded",toastTime:Date.now(),toastDuration:5e3})}})}}},{key:"setupSockets",value:function(){var e=this,t=f()(this.state.globalSettings.serverRoot);t.emit("new-user"),t.on("new-message",function(t){console.log("Message from server  :",t);var a=e.state.chats;a[e.state.activeChatIndex].messages.push(t),e.setState({chats:a})}),t.on("get-status",function(t){"online"===t?e.setState({online:!0}):e.setState({online:!1})}),t.on("update-status",function(t){console.log("Recieved update",t),"online"===t?e.setState({online:!0}):e.setState({online:!1})}),this.setState({socket:t})}},{key:"handleProceedButton",value:function(e,t,a){var n=this;this.setState({loginFormMessage:s.a.createElement("span",null,s.a.createElement("img",{src:b.a,className:"loading",alt:"..."}),s.a.createElement("span",null,"Please wait, attempting to log you in...  "))}),I.post(this.state.globalSettings.serverRoot+"login",{name:e,password:t,newAccount:a,withCredentials:!0},{withCredentials:!0}).then(function(e){if(e.data.error)return n.setState({loginFormMessage:e.data.error}),void console.error("Login attempt response error : ",e.data);var t=n.state.globalSettings;t.name=e.data.name,t.loggedIn=!0,n.setState({globalSettings:t,newAccount:e.data.newAccount}),I.get("".concat(n.state.globalSettings.serverRoot,"my-chats"),{withCredentials:!0},{withCredentials:!0}).then(function(e){if(e.data.error)return n.setState({toast:"An error occurred while trying to load your chats\n, please try again.",toastTime:Date.now(),toastDuration:5e3}),void console.error("Login",e.data.error);n.setupSockets();var t=n.state;t.chats=e.data,t.notDownloaded=!1,n.setState(t),setTimeout(n.createInitialChatRefreshInterval,6e3)}).catch(function(e){alert("An error occured while fetching your chats, please reload the app"),console.error("Fetching chats",e)})}).catch(function(e){console.error("OOPS",e),n.setState({toast:e.toString(),toastTime:Date.now(),toastDuration:5e3})})}},{key:"activate",value:function(e){if(this.state.activeChatIndex>=0){var t=this.state.activeChatIndex,a=this.state.active;console.log("Leaveing room",a,this.state.chats[t].id),this.state.socket.emit("leave-room",[a,this.state.chats[t].id])}this.setState({active:e,onine:!1});var n=-1;this.state.chats.find(function(t,a){if(t.name===e)return n=a,a}),console.log("Chat switched"),this.setState({activeChatIndex:n}),this.state.socket.emit("join-room",[e,this.state.chats[n].id]),console.log("Joining room",e,this.state.chats[n].id),console.log("Loading new messages for selected  chat",this.state.chats[n].id,this.state.chats[n].messages[this.state.chats[n].messages.length-1].date),this.fecthNewMessagesForParticularChat(null,this.state.chats[n].id,this.state.chats[n].messages[this.state.chats[n].messages.length-1].date),this.state.socket.emit("get-status",e),console.log("Request online status for ",e)}},{key:"fecthNewMessagesForParticularChat",value:function(e,t,a){var n=this;I.post("".concat(this.state.globalSettings.serverRoot,"my-chats/new-messages"),{withCredentials:!0,date:a,chatId:t},{withCredentials:!0}).then(function(e){if(e.data.length>0){var t=n.state.chats;t[n.state.activeChatIndex].messages=t[n.state.activeChatIndex].messages.concat(e.data),n.setState({chats:t})}}).catch(function(e){n.setState({toast:"Error while fetching new chats.",toastTime:Date.now(),toastDuration:5e3}),console.error("Fetch new messages error - >",e)}),this.handleMenuToggle()}},{key:"submitMessage",value:function(e,t,a){this.setState({toast:"Posting message",toastTime:Date.now(),toastDuration:1e3});var n=this.state.socket;console.log("Emitting new-message",t),n.emit("new-message",{message:t,chatId:a,from:this.state.globalSettings.name})}},{key:"handleToast",value:function(e,t){this.setState({toast:e,toastTime:Date.now(),toastDuration:t})}},{key:"handleNewChat",value:function(e){e.data.error?(console.error("New Chat Received error",e.data.error),this.setState({toast:"Failed to create a new conversation",toastTime:Math.random(),toastDuration:5e3})):e.data.empty?this.setState({toast:"No matching account for your query",toastTime:Math.random(),toastDuration:5e3}):this.setState({toast:"Success : New Conversation will download in 6 seconds ... ",toastTime:Date.now(),toastDuration:1e4})}},{key:"handleMenuToggle",value:function(){var e;console.log("Menu toggle"),e="menu-visible"===this.state.menuVisible?"invisible":"menu-visible",this.setState({menuVisible:e}),console.log(this.state.menuVisible)}},{key:"render",value:function(){if(this.state.globalSettings.loggedIn){var e=[],t=!0,a=!1,n=void 0;try{for(var o,i=this.state.chats[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var l=o.value;e.push(s.a.createElement(O,{name:l.name,onActivate:this.activate,globalSettings:this.state.globalSettings,active:l.name===this.state.active,key:l.name}))}}catch(f){a=!0,n=f}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}this.state.notDownloaded?e=s.a.createElement("p",{className:"no-chats text-center padding-10 color-white"},s.a.createElement("img",{className:"loading",src:b.a,alt:"..."}),"Downloading conversations..."):0===e.length&&(e=s.a.createElement("p",{className:"no-chats text-center padding-10 color-white"},"To begin, search the exact name of a person and start chatting!"));var r=[],c=!0,h=!1,u=void 0;try{for(var d,m=this.state.chats[Symbol.iterator]();!(c=(d=m.next()).done);c=!0)l=d.value,r.push(l.name)}catch(f){h=!0,u=f}finally{try{c||null==m.return||m.return()}finally{if(h)throw u}}var g=null;this.state.chats[this.state.activeChatIndex]&&(g=this.state.chats[this.state.activeChatIndex].id);var v="chats-inner "+this.state.menuVisible;return s.a.createElement("div",null,s.a.createElement(j,{online:this.state.online,name:this.state.active}),s.a.createElement("div",{className:"chat-app container"},s.a.createElement(w,{message:this.state.toast,time:this.state.toastTime,toastDuration:this.state.toastDuration}),s.a.createElement("div",{className:"row app-row"},s.a.createElement("div",{className:"col-md-4 chats"},s.a.createElement("button",{className:"menu-button",onClick:this.handleMenuToggle},s.a.createElement("img",{src:x.a,className:"menu-icon",alt:"Menu"})),s.a.createElement("comment",null,"Below contains menu items => search box and list of chats etc but not the menu toggler"),s.a.createElement("div",{className:v},s.a.createElement(k,{globalSettings:this.state.globalSettings,people:r,handleSearchResult:this.handleNewChat,handleToast:this.handleToast}),s.a.createElement("ul",null,e))),s.a.createElement("div",{className:"col-md-8 chatbox-container"},s.a.createElement(S,{name:this.state.active,globalSettings:this.state.globalSettings,chat:this.state.chats[this.state.activeChatIndex],submitMessage:this.submitMessage,socket:this.state.socket,chatId:g})))))}return s.a.createElement("div",null,s.a.createElement(w,{message:this.state.toast,time:this.state.toastTime,toastDuration:this.state.toastDuration}),s.a.createElement("div",{className:"mobile"},s.a.createElement("h1",null,"\ud83d\ude41 \ud83d\udcf1 \ud83d\udeab"),s.a.createElement("p",null,"We are sorry, but we currently dont support mobile devices Please use a desktop.")),s.a.createElement(y,{globalSettings:this.state.globalSettings,handleProceedButton:this.handleProceedButton,message:this.state.loginFormMessage}))}}]),t}(s.a.Component),D=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function T(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(s.a.createElement(M,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/chatapp",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/chatapp","/service-worker.js");D?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):T(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):T(t,e)})}}()},20:function(e,t,a){e.exports=a.p+"static/media/loading.e6ebdebf.gif"},45:function(e,t){e.exports={globalSettings:{name:null,id:null,email:null,accessKey:null,loggedIn:null,serverRoot:"https://chat-app-hereisdx.herokuapp.com/"}}},47:function(e,t,a){e.exports=a.p+"static/media/menu.b4642141.svg"},48:function(e,t,a){e.exports=a(102)},53:function(e,t,a){},80:function(e,t){},99:function(e,t,a){}},[[48,1,2]]]);
//# sourceMappingURL=main.e49f0cf1.chunk.js.map